{"pages":[],"posts":[{"title":"Androidå¼€ç½å¤´â€”â€”â€”å¤–éƒ¨å­˜å‚¨ä¸å†…éƒ¨å­˜å‚¨å®Œå…¨è§£æ","permalink":"http://www.youyuge.cn/2017/06/02/storage-explaination/","text":"context.getExternalFilesDir(),Environment.getExternalStorageDirectory()ï¼Œå‚»å‚»åˆ†ä¸æ¸…ï¼Ÿåˆ°åº•ä»€ä¹ˆç®—å®‰å“æ‰‹æœºçš„external storageï¼Ÿ ä¸€ã€å­˜å‚¨æ¦‚è¿°Androidæä¾›äº†å‡ ç§ä¿å­˜applicationæŒä¹…åŒ–æ•°æ®çš„é€‰æ‹©ã€‚è€Œå¼€å‘è€…æ ¹æ® æ•°æ®æ˜¯å¦ä¸ºappç§æœ‰ æ•°æ®æ˜¯å¦å¯ä»¥æš´éœ²ç»™å…¶ä»–app æ•°æ®å¤§å°æƒ…å†µ æ¥é€‰æ‹©ä¸åŒçš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚ 1.1 å­˜å‚¨æ–¹å¼å®‰å“æä¾›äº†å¦‚ä¸‹å­˜å‚¨çš„æ–¹å¼é€‰æ‹©ï¼š ç±»åˆ« ä½œç”¨ Shared Preferences ä»¥é”®å€¼å¯¹å½¢å¼åœ¨xmlä¸­å­˜å‚¨é…ç½® Internal Storage ï¼ˆå†…éƒ¨å­˜å‚¨ï¼‰ è®¾å¤‡ä¸­çš„ç§æœ‰æ•°æ® External Storage ï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰ å…±äº«çš„å¤–éƒ¨å­˜å‚¨ä¸­å­˜å…¬æœ‰æ•°æ® SQLite Databases ç§æœ‰æ•°æ®åº“å­˜å‚¨æ ¼å¼åŒ–çš„æ•°æ® Network Connection åœ¨å¼€å‘è€…ä¸ªäººç½‘ç»œæœåŠ¡å™¨ç«¯å­˜å‚¨æ•°æ® 1.2 content providerå®‰å“æä¾›äº†ä¸€ç§ç”šè‡³å°†appçš„ç§æœ‰æ•°æ®æä¾›ç»™å…¶ä»–appçš„é€”å¾„â€”â€”â€”â€”content providerã€‚è€Œandroidå®˜æ–¹guideä¸­ä¸æŠŠå®ƒå½’ä¸ºStrage Optionsä¸­çš„ä¸€ç§ã€‚ äºŒã€Internal Storage å†…éƒ¨å­˜å‚¨2.1 å†…éƒ¨å­˜å‚¨å®šä¹‰ You can save files directly on the deviceâ€™s internal storage. By default, files saved to the internal storage are private to your application and other applications cannot access them (nor can the user). When the user uninstalls your application, these files are removed. ç™½è¯æ–‡ç‰ˆæœ¬ï¼šæ³¨æ„å†…éƒ¨å­˜å‚¨ä¸æ˜¯å†…å­˜ã€‚å†…éƒ¨å­˜å‚¨ä½äºç³»ç»Ÿä¸­å¾ˆç‰¹æ®Šçš„ä¸€ä¸ªä½ç½®ï¼ˆç±»ä¼¼æ²™ç›’ï¼‰ï¼Œå¦‚æœä½ æƒ³å°†æ–‡ä»¶å­˜å‚¨äºå†…éƒ¨å­˜å‚¨ä¸­ï¼Œé‚£ä¹ˆæ–‡ä»¶é»˜è®¤åªèƒ½è¢«ä½ çš„åº”ç”¨è®¿é—®åˆ°ï¼Œä¸”ä¸€ä¸ªåº”ç”¨æ‰€åˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨å’Œåº”ç”¨åŒ…åç›¸åŒçš„ç›®å½•ä¸‹ã€‚ä¹Ÿå°±æ˜¯è¯´åº”ç”¨åˆ›å»ºäºå†…éƒ¨å­˜å‚¨çš„æ–‡ä»¶ï¼Œä¸è¿™ä¸ªåº”ç”¨æ˜¯å…³è”èµ·æ¥çš„ã€‚å½“ä¸€ä¸ªåº”ç”¨å¸è½½ä¹‹åï¼Œå†…éƒ¨å­˜å‚¨ä¸­çš„è¿™äº›æ–‡ä»¶ä¹Ÿè¢«åˆ é™¤ã€‚ å†…éƒ¨å­˜å‚¨ç©ºé—´ååˆ†æœ‰é™ï¼Œå› è€Œæ˜¾å¾—å¯è´µï¼Œå¦å¤–ï¼Œå®ƒä¹Ÿæ˜¯ç³»ç»Ÿæœ¬èº«å’Œç³»ç»Ÿåº”ç”¨ç¨‹åºä¸»è¦çš„æ•°æ®å­˜å‚¨æ‰€åœ¨åœ°ï¼Œä¸€æ—¦å†…éƒ¨å­˜å‚¨ç©ºé—´è€—å°½ï¼Œæ‰‹æœºä¹Ÿå°±æ— æ³•ä½¿ç”¨äº†ã€‚æ‰€ä»¥å¯¹äºå†…éƒ¨å­˜å‚¨ç©ºé—´ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…ä½¿ç”¨ã€‚Shared Preferenceså’ŒSQLiteæ•°æ®åº“éƒ½æ˜¯å­˜å‚¨åœ¨å†…éƒ¨å­˜å‚¨ç©ºé—´ä¸Šçš„ã€‚å†…éƒ¨å­˜å‚¨ä¸€èˆ¬ç”¨Contextæ¥è·å–å’Œæ“ä½œã€‚ 2.2 åˆ›å»ºå¹¶å†™å…¥å†…éƒ¨å­˜å‚¨ Call openFileOutput() with the name of the file and the operating mode. This returns a FileOutputStream. Write to the file with write(). Close the stream with close(). å®‰å“è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€ä¾¿æ–¹æ³•Contextç±»çš„ openFileOutput()æ¥è¯»å†™åº”ç”¨åœ¨å†…éƒ¨å­˜å‚¨ç©ºé—´ä¸Šçš„æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå‘æ–‡ä»¶ä¸­å†™å…¥æ–‡æœ¬çš„ä¾‹å­ï¼š 12345String FILENAME = &quot;hello_file&quot;;String string = &quot;hello world!&quot;;FileOutputStream fos = openFileOutput(FILENAME, Context.MODE_PRIVATE);fos.write(string.getBytes());fos.close(); è¯»å–åŒç†ï¼ŒæŠŠwrite()æ¢æˆread()ç½¢äº†ã€‚ openFileOutput()æˆ–è€…Context.getFileDir()é€šè¿‡Android Device Monitorå·¥å…·å¯ä»¥æ‰¾åˆ°æ­¤ç›®å½•ï¼Œä¸º/data/data/com.xxx.xxx/files/ã€‚ æ‹“å±•ä¼˜åŒ–ï¼šä½¿ç”¨javaæµï¼Œå€ŸåŠ©FileOutputStreamæ„å»ºå‡ºä¸€ä¸ªOutputStreamWriterå¯¹è±¡ï¼Œæ¥ç€å†ç”¨BufferedWriterå¯¹è±¡å°è£…ï¼š 123FileOutputStream fos = openFileOutput(FILENAME, Context.MODE_PRIVATE);BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(fos));writer.write(string); 2.3 å†…éƒ¨å­˜å‚¨å…¶ä»–æ“ä½œ åˆ—å‡ºæ‰€æœ‰çš„å·²åˆ›å»ºçš„æ–‡ä»¶,è¿™ä¸ªå¯èƒ½ä¸å®¹æ˜“æƒ³åˆ°ï¼ŒContextå±…ç„¶æœ‰è¿™æ ·çš„æ–¹æ³•ã€‚ 1234String[] files = Context.fileList();for(String file : files) ï½›Log.e(TAG, &quot;file is &quot;+ file);&#125; åˆ é™¤æ–‡ä»¶ï¼Œèƒ½åˆ›å»ºå°±è¦èƒ½å¤Ÿåˆ é™¤ï¼Œå½“ç„¶ä¹Ÿä¼šæä¾›äº†åˆ é™¤æ–‡ä»¶çš„æ¥å£ï¼Œå®ƒä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦æä¾›æ–‡ä»¶å 12345if(Context.deleteFile(filename)) &#123;Log.e(TAG, &quot;delete file &quot;+ filename + &quot; sucessfullyâ€œ);&#125; else &#123;Log.e(TAG, &quot;failed to deletefile &quot; + filename);&#125; åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œéœ€è¦ä¼ å…¥ç›®å½•åç§°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ç”¨åˆ°æ“ä½œè·¯å¾„ 12File workDir = Context.getDir(dirName, Context.MODE_PRIVATE);Log.e(TAG, &quot;workdir &quot;+ workDir.getAbsolutePath(); 2.4 å†…éƒ¨å­˜å‚¨ç¼“å­˜cacheä½ åº”è¯¥ä½¿ç”¨getCacheDir()æ¥å†…éƒ¨ç»å¯¹ç¼“å­˜ç›®å½•Fileï¼Œè¿™äº›ç¼“å­˜å°†ä¼šæ˜¯åœ¨å­˜å‚¨ä¸å¤Ÿæ—¶ç¬¬ä¸€ä¸ªè¢«æ¸…é™¤çš„ï¼Œä½†æ˜¯ä¸ä¼šä¿è¯è¿™äº›æ–‡ä»¶ä¸€å®šä¼šè¢«æ¸…é™¤ã€‚é€šè¿‡Android Device Monitorå·¥å…·å¯ä»¥æ‰¾åˆ°æ­¤ç›®å½•ï¼Œä¸º/data/data/com.xxx.xxx/cache/ã€‚ Note:ä½ ä¸åº”è¯¥æŒ‡æœ›ç€ç³»ç»Ÿæ¥ç»™ä½ æ¸…ç†è¿™äº›cacheæ–‡ä»¶ï¼Œä½ åº”è¯¥è‡ªå·±è®¾å®šä¸€ä¸ªåˆç†çš„æœ€å¤§ä¸Šé™ï¼Œæ¯”å¦‚1MBã€‚å½“ç”¨æˆ·å¸è½½appæ—¶ï¼Œè¿™äº›æ–‡ä»¶åŒæ—¶è¢«å¸è½½ã€‚ 2.5 å†…éƒ¨å­˜å‚¨æ€»ç»“ æ–‡ä»¶æ“ä½œåªéœ€è¦å‘å‡½æ•°æä¾›æ–‡ä»¶åï¼Œæ‰€ä»¥ç¨‹åºè‡ªå·±åªéœ€è¦ç»´æŠ¤æ–‡ä»¶åå³å¯ï¼› ä¸ç”¨è‡ªå·±å»åˆ›å»ºæ–‡ä»¶å¯¹è±¡å’Œè¾“å…¥ã€è¾“å‡ºæµï¼Œæä¾›æ–‡ä»¶åå°±å¯ä»¥è¿”å›Fileå¯¹è±¡æˆ–è¾“å…¥è¾“å‡ºæµ å¯¹äºè·¯å¾„æ“ä½œè¿”å›çš„éƒ½æ˜¯æ–‡ä»¶å¯¹è±¡ã€‚ ç”±Contextç±»è°ƒç”¨ ä¸‰ã€External Storage å¤–éƒ¨å­˜å‚¨3.1 å¤–éƒ¨å­˜å‚¨å®šä¹‰ Every Android-compatible device supports a shared â€œexternal storageâ€ that you can use to save files. This can be a removable storage media (such as an SD card) or an internal (non-removable) storage. Files saved to the external storage are world-readable and can be modified by the user when they enable USB mass storage to transfer files on a computer. å¦å¤–ï¼Œå…³äºå¤–éƒ¨å­˜å‚¨ï¼Œæˆ‘è§‰å¾—apiä¸­åœ¨ä»‹ç»Environment.getExternalStorageDirectory()æ–¹æ³•çš„æ—¶å€™è¯´å¾—å¾ˆæ¸…æ¥šï¼š Note: donâ€™t be confused by the word â€œexternalâ€ here. This directory can better be thought as media/shared storage. It is a filesystem that can hold a relatively large amount of data and that is shared across all applications (does not enforce permissions). Traditionally this is an SD card, but it may also be implemented as built-in storage in a device that is distinct from the protected internal storage and can be mounted as a filesystem on a computer. ç™½è¯æ–‡ç‰ˆæœ¬ï¼šæœ€å®¹æ˜“æ··æ·†çš„æ˜¯å¤–éƒ¨å­˜å‚¨ï¼Œå¦‚æœè¯´pcä¸Šä¹Ÿè¦åŒºåˆ†å‡ºå¤–éƒ¨å­˜å‚¨å’Œå†…éƒ¨å­˜å‚¨çš„è¯ï¼Œé‚£ä¹ˆè‡ªå¸¦çš„ç¡¬ç›˜ç®—æ˜¯å†…éƒ¨å­˜å‚¨ï¼ŒUç›˜æˆ–è€…ç§»åŠ¨ç¡¬ç›˜ç®—æ˜¯å¤–éƒ¨å­˜å‚¨ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆå®¹æ˜“å¸¦ç€è¿™æ ·çš„ç†è§£å»çœ‹å¾…å®‰å“æ‰‹æœºï¼Œè®¤ä¸ºæœºèº«å›ºæœ‰å­˜å‚¨æ˜¯å†…éƒ¨å­˜å‚¨ï¼Œè€Œæ‰©å±•çš„TFå¡æ˜¯å¤–éƒ¨å­˜å‚¨ã€‚æ¯”å¦‚æˆ‘ä»¬ä»»åŠ¡16GBç‰ˆæœ¬çš„Nexus 4æœ‰16Gçš„å†…éƒ¨å­˜å‚¨ï¼Œæ™®é€šæ¶ˆè´¹è€…å¯ä»¥è¿™æ ·ç†è§£ï¼Œä½†æ˜¯å®‰å“çš„ç¼–ç¨‹ä¸­ä¸èƒ½ï¼Œè¿™16GBä»ç„¶æ˜¯å¤–éƒ¨å­˜å‚¨ã€‚æ‰€æœ‰çš„å®‰å“è®¾å¤‡éƒ½æœ‰å¤–éƒ¨å­˜å‚¨å’Œå†…éƒ¨å­˜å‚¨ï¼Œè¿™ä¸¤ä¸ªåç§°æ¥æºäºå®‰å“çš„æ—©æœŸè®¾å¤‡ï¼Œé‚£ä¸ªæ—¶å€™çš„è®¾å¤‡å†…éƒ¨å­˜å‚¨ç¡®å®æ˜¯å›ºå®šçš„ï¼Œè€Œå¤–éƒ¨å­˜å‚¨ç¡®å®æ˜¯å¯ä»¥åƒUç›˜ä¸€æ ·ç§»åŠ¨çš„ã€‚ä½†æ˜¯åœ¨åæ¥çš„è®¾å¤‡ä¸­ï¼Œå¾ˆå¤šä¸­é«˜ç«¯æœºå™¨éƒ½å°†è‡ªå·±çš„æœºèº«å­˜å‚¨æ‰©å±•åˆ°äº†8Gä»¥ä¸Šï¼Œä»–ä»¬å°†å­˜å‚¨åœ¨æ¦‚å¿µä¸Šåˆ†æˆäº†â€å†…éƒ¨internalâ€ å’Œâ€å¤–éƒ¨externalâ€ ä¸¤éƒ¨åˆ†ï¼Œä½†å…¶å®éƒ½åœ¨æ‰‹æœºå†…éƒ¨ã€‚æ‰€ä»¥ä¸ç®¡å®‰å“æ‰‹æœºæ˜¯å¦æœ‰å¯ç§»åŠ¨çš„sdcardï¼Œä»–ä»¬æ€»æ˜¯æœ‰å¤–éƒ¨å­˜å‚¨å’Œå†…éƒ¨å­˜å‚¨ã€‚æœ€å…³é”®çš„æ˜¯ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ç›¸åŒçš„apiæ¥è®¿é—®å¯ç§»åŠ¨çš„sdcardæˆ–è€…æ‰‹æœºè‡ªå¸¦çš„å­˜å‚¨ï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰ã€‚ 3.2 è·å–æƒé™manifestä¸­å¿…é¡»æ·»åŠ ï¼š 1234&lt;manifest ...&gt; &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt; ...&lt;/manifest&gt; Android 6.0ä¹‹åæ–°åŠ å…¥äº†è¿è¡Œæ—¶æƒé™ï¼Œè¿™é‡Œä¸ä½œè¯¦è§£ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š å®˜æ–¹æ–‡æ¡£ï¼šhttps://developer.android.com/about/versions/marshmallow/android-6.0.html 3.3 æ£€æŸ¥çŠ¶æ€åœ¨ä½¿ç”¨å¤–éƒ¨å­˜å‚¨ä¹‹å‰ï¼Œä½ å¿…é¡»è¦ä½¿ç”¨getExternalStorageState()æ–¹æ³•ï¼Œå…ˆæ£€æŸ¥å¤–éƒ¨å­˜å‚¨çš„å½“å‰çŠ¶æ€ï¼Œä»¥åˆ¤æ–­æ˜¯å¦å¯ç”¨ï¼š 1234567891011121314151617/* Checks if external storage is available for read and write */public boolean isExternalStorageWritable() &#123; String state = Environment.getExternalStorageState(); if (Environment.MEDIA_MOUNTED.equals(state)) &#123; return true; &#125; return false;&#125;/* Checks if external storage is available to at least read */public boolean isExternalStorageReadable() &#123; String state = Environment.getExternalStorageState(); if (Environment.MEDIA_MOUNTED.equals(state) || Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) &#123; return true; &#125; return false;&#125; 3.4 å¤–éƒ¨å­˜å‚¨å†™å…¥æ–‡ä»¶è·å–äº†æƒé™ï¼Œæ£€æŸ¥äº†çŠ¶æ€ä¹‹åï¼Œç»ˆäºå¯ä»¥å†™å…¥äº†ï¼Œè€Œåˆæœ‰ä¸¤ç§ç±»å‹çš„æ–‡ä»¶ï¼š å¤–éƒ¨å­˜å‚¨å…±æœ‰æ–‡ä»¶ å¤–éƒ¨å­˜å‚¨ç§æœ‰æ–‡ä»¶ 3.4.1 å¤–éƒ¨å­˜å‚¨å…±æœ‰æ–‡ä»¶ Saving files that can be shared with other apps å…¬å…±æ–‡ä»¶Public filesï¼šæ–‡ä»¶æ˜¯å¯ä»¥è¢«è‡ªç”±è®¿é—®ï¼Œç›®å½•ä»»æ„ï¼Œä¸”æ–‡ä»¶çš„æ•°æ®å¯¹å…¶ä»–åº”ç”¨æˆ–è€…ç”¨æˆ·æ¥è¯´éƒ½æ˜¯ç”±æ„ä¹‰çš„ï¼Œå½“åº”ç”¨è¢«å¸è½½ä¹‹åï¼Œå…¶å¸è½½å‰åˆ›å»ºçš„æ–‡ä»¶ä»ç„¶ä¿ç•™ã€‚æ¯”å¦‚cameraåº”ç”¨ï¼Œç”Ÿæˆçš„ç…§ç‰‡å¤§å®¶éƒ½èƒ½è®¿é—®ï¼Œè€Œä¸”cameraä¸åœ¨äº†ï¼Œç…§ç‰‡ä»ç„¶åœ¨ã€‚ä¸¾ä¸ªæ —å­ï¼Œä¸‹é¢çš„æ–¹æ³•åœ¨å…¬å…±çš„å›¾ç‰‡ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å›¾ç‰‡ç›¸å†Œç›®å½•ï¼š 123456789public File getAlbumStorageDir(String albumName) &#123; // Get the directory for the user&apos;s public pictures directory. File file = new File(Environment.getExternalStoragePublicDirectory( Environment.DIRECTORY_PICTURES), albumName); if (!file.mkdirs()) &#123; Log.e(LOG_TAG, &quot;Directory not created&quot;); &#125; return file;&#125; æ³¨æ„ï¼Œå¦‚æœä½ çš„api ç‰ˆæœ¬ä½äº8ï¼Œé‚£ä¹ˆä¸èƒ½ä½¿ç”¨getExternalStoragePublicDirectory()ï¼Œè€Œæ˜¯ä½¿ç”¨Environment.getExternalStorageDirectory(),ä»–ä¸å¸¦å‚æ•°ï¼Œä¹Ÿå°±ä¸èƒ½è‡ªå·±åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œåªæ˜¯è¿”å›å¤–éƒ¨å­˜å‚¨çš„æ ¹è·¯å¾„ã€‚ èº²é¿åª’ä½“æ‰«æåœ¨ä½ çš„å¤–éƒ¨ç›®å½•ä¸‹æ”¾ä¸€ä¸ªåä¸º.nomediaçš„ç©ºæ–‡ä»¶ï¼Œåˆ™ä¼šé˜»æ­¢åª’ä½“æ‰«æå™¨é€šè¿‡MediaStore content provideræ¥è¯»å–ä½ çš„åª’ä½“æ–‡ä»¶ï¼ˆæ¯”å¦‚ç›¸å†Œä¸­å°±ä¸ä¼šæ˜¾ç¤ºï¼‰ã€‚ä½†æ˜¯æ›´å¥½çš„åŠæ³•æ˜¯ç”¨ä¸‹é¢ğŸ‘‡çš„å¤–éƒ¨å­˜å‚¨ç§äººæ¨¡å¼ã€‚ 3.4.2 å¤–éƒ¨å­˜å‚¨ç§æœ‰æ–‡ä»¶ If you are handling files that are not intended for other apps to use (such as graphic textures or sound effects used by only your app), you should use a private storage directory on the external storage by calling getExternalFilesDir(). å…¶å®ç”±äºæ˜¯å¤–éƒ¨å­˜å‚¨çš„åŸå› å³æ˜¯æ˜¯è¿™ç§ç±»å‹çš„æ–‡ä»¶ä¹Ÿèƒ½è¢«å…¶ä»–ç¨‹åºè®¿é—®ï¼Œåªä¸è¿‡ä¸€ä¸ªåº”ç”¨ç§æœ‰çš„æ–‡ä»¶å¯¹å…¶ä»–åº”ç”¨å…¶å®æ˜¯æ²¡æœ‰è®¿é—®ä»·å€¼çš„ï¼ˆæ¶æ„ç¨‹åºé™¤å¤–ï¼‰ã€‚å¤–éƒ¨å­˜å‚¨ä¸Šï¼Œåº”ç”¨ç§æœ‰æ–‡ä»¶çš„ä»·å€¼åœ¨äºå¸è½½ä¹‹åï¼Œè¿™äº›æ–‡ä»¶ä¹Ÿä¼šè¢«åˆ é™¤ã€‚ç±»ä¼¼äºå†…éƒ¨å­˜å‚¨ã€‚ æ‰€æœ‰åº”ç”¨ç¨‹åºçš„å¤–éƒ¨å­˜å‚¨çš„ç§æœ‰æ–‡ä»¶éƒ½æ”¾åœ¨æ ¹ç›®å½•çš„Android/data/ä¸‹ï¼Œç›®å½•å½¢å¼ä¸º/Android/data/&lt;package_name&gt;/ã€‚ Android 4.3åŠå…¶ä»¥ä¸‹ä½¿ç”¨getExternalFilesDir()æ–¹æ³•å¯èƒ½åªä¼šè¯»å–æ‰‹æœºå†…éƒ¨ç©ºé—´ï¼Œè€ŒéSDå¡ã€‚ ä½¿ç”¨ContextCompat.getExternalFilesDirs()ï¼Œæˆ–è€…4.4ç‰ˆæœ¬ä»¥ä¸Šä½¿ç”¨getExternalFilesDirs()ä¼šè¿”å›ä¸€ä¸ªFileæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªæ˜¯é»˜è®¤çš„å¤–éƒ¨å­˜å‚¨ã€‚ åˆ›å»ºåº”ç”¨ç§æœ‰æ–‡ä»¶çš„æ–¹æ³•æ˜¯Context.getExternalFilesDir()ï¼Œå¦‚ä¸‹ï¼š 123456789public File getAlbumStorageDir(Context context, String albumName) &#123;// Get the directory for the app&apos;s private pictures directory.File file = newFile(context.getExternalFilesDir(Environment.DIRECTORY_PICTURES), albumName);if(!file.mkdirs()) &#123;Log.e(LOG_TAG, &quot;Directory not created&quot;);&#125;returnfile;&#125; ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªpictureç›®å½•ï¼Œå¹¶åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªåä¸ºalbumNameçš„æ–‡ä»¶ï¼ŒEnvironment.DIRECTORY_PICTURESå…¶å®å°±æ˜¯å­—ç¬¦ä¸²pictureã€‚ å¦‚æœä½ çš„api ç‰ˆæœ¬ä½äº8ï¼Œé‚£ä¹ˆä¸èƒ½ä½¿ç”¨getExternalFilesDir()ï¼Œè€Œæ˜¯ä½¿ç”¨Environment.getExternalStorageDirectory()è·å¾—æ ¹è·¯å¾„ä¹‹åï¼Œè‡ªå·±å†æƒ³åŠæ³•æ“ä½œ/Android/data/&lt;package_name&gt;/ä¸‹çš„æ–‡ä»¶ã€‚ æ³¨æ„ï¼Œåª’ä½“æ‰«æå™¨ä¹Ÿä¸èƒ½é€šè¿‡MediaStore content provideræ‰«æå†…éƒ¨å­˜å‚¨ç§æœ‰æ–‡ä»¶ï¼Œæ‰€ä»¥ä½ ä¸åº”åœ¨è¿™é‡Œå­˜å‚¨ç…§ç‰‡ã€éŸ³ä¹ã€‚ä½†æ˜¯åˆ«çš„åº”ç”¨å¯ä»¥è¯»å–åˆ°ä»–ä»¬ã€‚ 3.5 å¤–éƒ¨å­˜å‚¨ç¼“å­˜ To open a File that represents the external storage directory where you should save cache files, call getExternalCacheDir(). If the user uninstalls your application, these files will be automatically deleted. è°ƒç”¨contextçš„getExternalCacheDir()æ–¹æ³•è·å–å¤–éƒ¨å­˜å‚¨çš„ç§æœ‰ç¼“å­˜æ–‡ä»¶å¤¹ã€‚ å››ã€å„ç§ç›®å½•æ‰“å°æœ€åä¸ºäº†å¼„æ¸…æ¥šgetFilesDirï¼ŒgetExternalFilesDirï¼ŒgetExternalStorageDirectoryï¼ŒgetExternalStoragePublicDirectoryç­‰androidæ–‡ä»¶æ“ä½œæ–¹æ³•ï¼Œæˆ‘å°†è¿™äº›æ–¹æ³•çš„æ‰§è¡Œç»“æœæ‰“å°å‡ºæ¥ï¼Œçœ‹çœ‹åˆ°åº•è·¯å¾„æ˜¯å•¥æ ·ï¼Œåœ¨activityä¸­æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š 123456Log.i(&quot;codecraeer&quot;, &quot;getFilesDir = &quot; + getFilesDir());Log.i(&quot;codecraeer&quot;, &quot;getExternalFilesDir = &quot; + getExternalFilesDir(&quot;exter_test&quot;).getAbsolutePath());Log.i(&quot;codecraeer&quot;, &quot;getDownloadCacheDirectory = &quot; + Environment.getDownloadCacheDirectory().getAbsolutePath());Log.i(&quot;codecraeer&quot;, &quot;getDataDirectory = &quot; + Environment.getDataDirectory().getAbsolutePath());Log.i(&quot;codecraeer&quot;, &quot;getExternalStorageDirectory = &quot; + Environment.getExternalStorageDirectory().getAbsolutePath());Log.i(&quot;codecraeer&quot;, &quot;getExternalStoragePublicDirectory = &quot; + Environment.getExternalStoragePublicDirectory(&quot;pub_test&quot;)); åœ¨logä¸­çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š äº”ã€æ€»ç»“ä¸€å¼ å›¾æ€»ç»“ï¼Œæˆ‘ä¸ªäººçš„ç†è§£æ˜¯å­˜å‚¨æŒ‰ç…§ä¸åŒçš„è§’åº¦åˆ†ä¸ºä¸¤ç§ï¼š æŒ‰ç…§å†…å¤–éƒ¨ï¼šå†…éƒ¨å­˜å‚¨ï¼Œå¤–éƒ¨å­˜å‚¨ åŒºåˆ«ï¼šå¸¦Externalå­—çœ¼åˆ™ä¸€å®šæ˜¯å¤–éƒ¨å­˜å‚¨çš„æ–¹æ³•ï¼Œå¦‚getExternalFilesDir()ï¼Œå¤–éƒ¨å­˜å‚¨éœ€è¦è¿è¡Œæ—¶æƒé™ æŒ‰ç…§å…±æœ‰ç§æœ‰æ€§è´¨ï¼šå…¬å…±æ–‡ä»¶ï¼Œç§æœ‰æ–‡ä»¶ åŒºåˆ«ï¼šå…¬å…±æ–‡ä»¶æ˜¯Environmentè°ƒç”¨å‡½æ•°ï¼Œè€Œç§æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬å†…éƒ¨ç§æœ‰ä¸å¤–éƒ¨ç§æœ‰ï¼‰æ˜¯Contextè°ƒç”¨å‡½æ•°ï¼Œå…¬å…±æ–‡ä»¶ä¸ä¼šéšç€appå¸è½½è€Œåˆ é™¤ï¼Œç§æœ‰åˆ™ä¼šã€‚ç§æœ‰æ–‡ä»¶ä¸ä¼šè¢«Media Scanneræ‰«æåˆ°ã€‚ å¼•ç”¨ androidä¸­çš„æ–‡ä»¶æ“ä½œè¯¦è§£ä»¥åŠå†…éƒ¨å­˜å‚¨å’Œå¤–éƒ¨å­˜å‚¨ http://developer.android.com/training/basics/data-storage/files.html#InternalVsExternalStorage http://developer.android.com/guide/topics/data/data-storage.html https://developer.android.com/about/versions/marshmallow/android-6.0.html"},{"title":"Androidç½å¤´â€”â€”â€”â€”ShapeDrawableè¯¦è§£","permalink":"http://www.youyuge.cn/2017/06/01/Android_ShapeDrawable/","text":"æœ¬æ–‡å¯¹shapeè¿™ç§drawableè¯¦ç»†è§£æï¼Œä»è€Œå¯ä»¥ç®€å•åœ°å®ç°æ¸å˜ï¼Œåœ†è§’çŸ©å½¢ç­‰ç­‰æ•ˆæœçš„èƒŒæ™¯ã€‚æœ€åæœ‰ç¤ºä¾‹ã€‚ Drawableç§ç±»ç¹å¤šï¼ŒShapeDrawable æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„Drawable,å¯ä»¥ç†è§£ä¸ºé€šè¿‡é¢œè‰²æ¥æ„é€ çš„å›¾å½¢ï¼Œå®ƒæ—¢å¯ä»¥æ˜¯çº¯è‰²çš„å›¾å½¢ï¼Œä¹Ÿå¯ä»¥æ˜¯å…·æœ‰æ¸å˜æ•ˆæœçš„å›¾å½¢ã€‚ ä¸€ã€ShapeDrawableè¯­æ³•ShapeDrawableè¯­æ³•ç¨æ˜¾å¤æ‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233343536&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:shape=[&quot;rectangle&quot; | &quot;oval&quot; | &quot;line&quot; | &quot;ring&quot;] &gt; &lt;corners android:radius=&quot;integer&quot; android:topLeftRadius=&quot;integer&quot; android:topRightRadius=&quot;integer&quot; android:bottomLeftRadius=&quot;integer&quot; android:bottomRightRadius=&quot;integer&quot; /&gt; &lt;gradient android:angle=&quot;integer&quot; android:centerX=&quot;integer&quot; android:centerY=&quot;integer&quot; android:centerColor=&quot;integer&quot; android:endColor=&quot;color&quot; android:gradientRadius=&quot;integer&quot; android:startColor=&quot;color&quot; android:type=[&quot;linear&quot; | &quot;radial&quot; | &quot;sweep&quot;] android:useLevel=[&quot;true&quot; | &quot;false&quot;] /&gt; &lt;padding android:left=&quot;integer&quot; android:top=&quot;integer&quot; android:right=&quot;integer&quot; android:bottom=&quot;integer&quot; /&gt; &lt;size android:width=&quot;integer&quot; android:height=&quot;integer&quot; /&gt; &lt;solid android:color=&quot;color&quot; /&gt; &lt;stroke android:width=&quot;integer&quot; android:color=&quot;color&quot; android:dashWidth=&quot;integer&quot; android:dashGap=&quot;integer&quot; /&gt;&lt;/shape&gt; éœ€è¦æ³¨æ„çš„æ˜¯&lt;shape&gt;æ ‡ç­¾åˆ›å»ºçš„Drawableï¼Œå…¶å®ä½“ç±»å®é™…ä¸Šæ˜¯GradientDrawableï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»å„ä¸ªå±æ€§çš„å«ä¹‰ã€‚ äºŒã€å„å±æ€§å«ä¹‰ android:shapeæ ¹å…ƒç´ shapeè¡¨ç¤ºå›¾å½¢çš„å½¢çŠ¶ï¼Œæœ‰å››ä¸ªé€‰é¡¹ï¼š rectangle çŸ©å½¢ oval æ¤­åœ† line æ¨ªçº¿ ring åœ†ç¯ å¦å¤–å››ä¸ªå½“ä¸­ï¼Œline å’Œ ring ä¸€å®šéœ€è¦é€šè¿‡&lt;stroke&gt;æ ‡ç­¾æ¥æŒ‡å®šçº¿çš„å®½å’Œå’Œé¢œè‰²ä¿¡æ¯ç­‰ã€‚ &lt;corners&gt;è¡¨ç¤ºshapeå›¾å½¢å››ä¸ªäº¤çš„è§’åº¦ï¼Œå³å››ä¸ªè§’çš„åœ†è§’ç¨‹åº¦ã€‚å•ä½æ˜¯pxï¼Œåªé€‚ç”¨äºçŸ©å½¢shapeã€‚ android:radiusä¼˜å…ˆçº§è¾ƒä½ï¼Œä¼šè¢«å…¶ä»–å››ä¸ªå±æ€§è¦†ç›–ã€‚å±æ€§å«ä¹‰æœ›æ–‡ç”Ÿä¹‰å³å¯ã€‚æ³¨æ„ï¼šæ¯ä¸ªåœ†è§’åŠå¾„å€¼éƒ½å¿…é¡»å¤§äº1ï¼Œå¦ä¾§å°±æ²¡æœ‰åœ†è§’ã€‚ &lt;solid&gt;è¡¨ç¤ºçº¯è‰²å¡«å……ï¼Œåˆ©ç”¨ android:color å°±å¯ä»¥æŒ‡å®šshapeçš„é¢œè‰²ã€‚ &lt;gradient&gt;æ¸å˜æ•ˆæœï¼Œå’Œ&lt;solid&gt;æ ‡ç­¾äº’æ–¥ã€‚ gradientæ ‡ç­¾å±æ€§ ä½œç”¨ android:angle æ¸å˜çš„è§’åº¦ï¼Œé»˜è®¤æ˜¯0ï¼Œå…¶å€¼å¿…é¡»æ˜¯45çš„æ•´æ•°å€ã€‚0è¡¨ç¤ºä»å·¦è¾¹åˆ°å³ï¼Œ90è¡¨ç¤ºä»ä¸Šåˆ°ä¸‹ã€‚å…·ä½“æ•ˆæœéšç€è§’åº¦çš„è°ƒæ•´è€Œäº§ç”Ÿå˜åŒ–ï¼Œè§’åº¦å½±å“æ¸å˜æ–¹å‘ã€‚ android:centerX æ¸å˜ä¸­å¿ƒçš„æ¨ªåæ ‡ç‚¹ android:centerY æ¸å˜ä¸­å¿ƒçš„çºµåæ ‡ç‚¹ android:startColor æ¸å˜è‰²çš„èµ·å§‹è‰² android:centerColor æ¸å˜è‰²çš„ä¸­é—´è‰² android:endColor æ¸å˜è‰²çš„ç»“æŸè‰² android:type æ¸å˜çš„ç±»å‹ï¼Œåˆ†3ç§ï¼Œlinearï¼ˆçº¿æ€§æ¸å˜ï¼‰ï¼Œradioï¼ˆå¾„å‘æ¸å˜ï¼‰ï¼Œsweepï¼ˆæ‰«æçº¿æ¸å˜ï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ çº¿æ€§æ¸å˜ ã€‚ android:gradientRadius æ¸å˜çš„åŠå¾„ï¼ˆä»…å½“ android:type ä¸ºradioæ—¶æœ‰æ•ˆï¼‰ android:useLevel ä¸€èˆ¬ä¸ºfalseï¼Œå½“Drawableä½œä¸ºStateListDrawableæ—¶æœ‰æ•ˆã€‚ &lt;stroke&gt;Shapeçš„æè¾¹ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªå±æ€§ï¼š strokeæ ‡ç­¾å±æ€§ ä½œç”¨ android:width æè¾¹çš„å®½åº¦ï¼Œè¶Šå¤§åˆ™shapeçš„è¾¹ç¼˜çº¿è¶Šç²— android:color æè¾¹çš„é¢œè‰² android:dashWidth è™šçº¿çš„å®½åº¦ android:dashGap è™šçº¿çš„ç©ºéš™çš„é—´éš” æ³¨ï¼šå¦‚æœ android:dashWidth å’Œ android:dashGap ä¸¤è€…æœ‰ä»»æ„ä¸€ä¸ªä¸º0ï¼Œé‚£ä¹ˆè™šçº¿æ•ˆæœå°±æ— æ³•æ˜¾ç¤ºã€‚ &lt;padding&gt;ä¸æ˜¯shapeçš„ç©ºç™½ï¼Œè€Œæ˜¯åŒ…å«å®ƒçš„Viewçš„ç©ºç™½ &lt;size&gt;shapeæ²¡æœ‰å®½/é«˜çš„æ¦‚å¿µï¼Œæ€»ç»“æ¥è¯´ï¼Œæ ‡ç­¾è®¾ç½®çš„å®½é«˜å°±æ˜¯ShapeDrawableçš„å›ºæœ‰å®½é«˜ï¼ˆè¿™æ—¶è°ƒç”¨getIntrinsicWidthè·å¾—çš„å°±ä¸æ˜¯-1äº†ï¼‰ï¼Œä½†æ˜¯ä½œä¸ºViewçš„èƒŒæ™¯æ—¶ï¼Œå®ƒè¿˜æ˜¯ä¼šæ‹‰ä¼¸æˆ–ç¼©å°è‡ªé€‚åº”Viewçš„å¤§å°ã€‚ ä¸‰ã€ç¤ºä¾‹ä»£ç 3.1 æœç´¢æ¡†æ¸å˜èƒŒæ™¯ï¼šxmlä»£ç ï¼š 1234567891011&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:shape=&quot;rectangle&quot;&gt; &lt;gradient android:angle=&quot;90&quot; android:startColor=&quot;@color/color_fed952&quot; android:endColor=&quot;#ff9b00&quot; /&gt;&lt;/shape&gt; å®é™…æ•ˆæœï¼š 3.2 æœç´¢æ¡†æ–‡å­—èƒŒæ™¯ï¼šxmlä»£ç ï¼š 1234567&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:shape=&quot;rectangle&quot;&gt; &lt;corners android:radius=&quot;6dp&quot;/&gt; &lt;solid android:color=&quot;@color/white&quot;/&gt;&lt;/shape&gt; å…¶å®å°±æ˜¯ä¸ªeditTextçš„èƒŒæ™¯æ˜¯ç™½è‰²çš„åœ†è§’çŸ©å½¢ï¼Œé…åˆä¸Šæ¸å˜èƒŒæ™¯ï¼Œæœ€åæœç´¢æ¡†æ•´ä½“æ•ˆæœå›¾ï¼š 3.3 æœç´¢æ¡†å¸ƒå±€æ–‡ä»¶ä»£ç xmlä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738&lt;RelativeLayout android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot; android:background=&quot;@drawable/bg_home_search&quot; android:padding=&quot;8dp&quot; &gt; &lt;TextView android:id=&quot;@+id/qrcode_view&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_centerVertical=&quot;true&quot; android:background=&quot;@drawable/bar_code_scan_icon&quot; /&gt; &lt;TextView android:id=&quot;@+id/category_view&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_alignParentRight=&quot;true&quot; android:layout_centerVertical=&quot;true&quot; android:background=&quot;@drawable/category&quot; /&gt; &lt;TextView android:id=&quot;@+id/search_view&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot; android:layout_marginLeft=&quot;10dp&quot; android:layout_marginRight=&quot;10dp&quot; android:layout_toLeftOf=&quot;@id/category_view&quot; android:layout_toRightOf=&quot;@id/qrcode_view&quot; android:background=&quot;@drawable/bg_home_edittext&quot; android:gravity=&quot;center&quot; android:padding=&quot;6dp&quot; android:text=&quot;@string/home_edittext_hint&quot; android:textColor=&quot;@color/color_cdcdcd&quot; android:textSize=&quot;16sp&quot; /&gt; &lt;/RelativeLayout&gt;"},{"title":"é¢è¯•ç½å¤´ï¼ˆäºŒï¼‰---- androidæ’ä»¶åŒ–é¢è¯•é¢˜","permalink":"http://www.youyuge.cn/2017/05/22/plugin-mianshi/","text":"1. æ’ä»¶åŒ–æ¥ç”±1.1 æ–¹æ³•æ•°é—®é¢˜65536ä¸ºæ–¹æ³•æ•°ä¸Šé™ 2. æ’ä»¶åŒ–æ‰€è¦è§£å†³çš„é—®é¢˜ åŠ¨æ€åŠ è½½apk èµ„æºåŠ è½½ ä»£ç åŠ è½½"},{"title":"é¢è¯•ç½å¤´(ä¸€)-â€”â€”-okhttpå†…éƒ¨æ€»ç»“åˆ†æ","permalink":"http://www.youyuge.cn/2017/05/21/mianshi_1/","text":"æœ¬æ–‡æ„å›¾æ˜¯é’ˆå¯¹é¢è¯•ï¼Œç†æ¸…å†…éƒ¨æµç¨‹å…³ç³»ï¼Œè€Œéç»†æŠ ä»£ç ï¼Œæ±‡æ€»ä»–äººçš„æ–‡å­—è€Œæ¥ã€‚ 1.æ¦‚è¿°okhttp3æ€»ä½“æµç¨‹å›¾ï¼šå…ˆæ¥å›é¡¾ä¸€ä¸‹ä»£ç çš„ä½¿ç”¨æµç¨‹ï¼Œç„¶åè·Ÿç€æµç¨‹ä¸€æ­¥æ­¥æ¥åˆ†æï¼š 1.1 åˆ›å»º OkHttpClient å¯¹è±¡OkHttpClient client = new OkHttpClient(); å…¶å®okHttpClientç”¨çš„ä¹Ÿæ˜¯builderæ„å»ºè€…æ¨¡å¼ï¼š public OkHttpClient() { this(new Builder()); } å®é™…ä¸Šï¼ŒOkHttpClient.Builder ç±»æˆå‘˜å¾ˆå¤šï¼Œç”¨æ¥è®¾ç½®è¿æ¥çš„å„ç§å‚æ•°ï¼Œå®˜æ–¹å»ºè®®ä½¿ç”¨å•ä¾‹æ¨¡å¼æ„å»ºä¸€ä¸ªclientï¼Œè¿™æ ·å¯ä»¥å…±ç”¨ç¼“å­˜å’Œçº¿ç¨‹æ± ã€‚ ç›´æ¥newåªæ˜¯ä½¿ç”¨äº†é»˜è®¤é…ç½®ï¼š 1234567891011121314151617181920public Builder() &#123; dispatcher = new Dispatcher(); protocols = DEFAULT_PROTOCOLS; connectionSpecs = DEFAULT_CONNECTION_SPECS; proxySelector = ProxySelector.getDefault(); cookieJar = CookieJar.NO_COOKIES; socketFactory = SocketFactory.getDefault(); hostnameVerifier = OkHostnameVerifier.INSTANCE; certificatePinner = CertificatePinner.DEFAULT; proxyAuthenticator = Authenticator.NONE; authenticator = Authenticator.NONE; connectionPool = new ConnectionPool(); dns = Dns.SYSTEM; followSslRedirects = true; followRedirects = true; retryOnConnectionFailure = true; connectTimeout = 10_000; readTimeout = 10_000; writeTimeout = 10_000;&#125; 1.2 åˆ›å»ºRequestè¯·æ±‚å¯¹è±¡å°è£…äº†è¯·æ±‚æŠ¥æ–‡çš„ä¿¡æ¯ï¼Œç”¨æ„å»ºè€…æ¨¡å¼æ„å»ºï¼š Request request = new Request.Builder() .url(url) .build(); 1.3 åˆ›å»ºCallå¯¹è±¡OkHttpClient å®ç°äº†Call.Factoryï¼Œè´Ÿè´£æ ¹æ®è¯·æ±‚åˆ›å»ºæ–°çš„ Callã€‚å¦‚ä¸Šå›¾ï¼Œè¡¨ç¤ºçš„æ˜¯é“¾æ¥clientå’Œrequestçš„æ¡¥æ¢ã€‚ callFactory è´Ÿè´£åˆ›å»º HTTP è¯·æ±‚ï¼ŒHTTP è¯·æ±‚è¢«æŠ½è±¡ä¸ºäº† okhttp3.Call ç±»ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå·²ç»å‡†å¤‡å¥½ï¼Œå¯ä»¥éšæ—¶æ‰§è¡Œçš„ HTTP è¯·æ±‚ Call call = client.newCall(request); 1.4 åŒæ­¥é˜»å¡æ‰§è¡Œè¯·æ±‚é˜»å¡å½“å‰çº¿ç¨‹ï¼š Response response = call.execute(); 1.5 å¼‚æ­¥å›è°ƒæ‰§è¡Œè¯·æ±‚ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œä¼šæ–°å¼€çº¿ç¨‹å¤„ç† call.enqueue(new Callback() { @Override public void onFailure(Call call, IOException e) { } @Override public void onResponse(Call call, Response response) throws IOException { System.out.println(response.body().string()); } }); 2. ç²¾å¦™çš„çº¿ç¨‹æ± 2.1 åŒæ­¥è¯·æ±‚æ—¶å®é™…ä¸ŠnewCallæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªRealcallå¯¹è±¡ï¼Œè€Œå®ƒåŒæ­¥æ‰§è¡Œexecute()æ–¹æ³•æ—¶ï¼š 12345678910111213141516@Override public Response execute() throws IOException &#123; synchronized (this) &#123; if (executed) throw new IllegalStateException(&quot;Already Executed&quot;); executed = true; &#125; try &#123; //ä»…ä»…æ ‡è®°ä½œç”¨ client.dispatcher().executed(this); //è¿™æ‰æ˜¯çœŸæ­£çš„æ‰§è¡Œä¸‹ä¸€æ­¥å‘è¯·æ±‚ï¼ŒåŒæ­¥å¼‚æ­¥éƒ½ä¼šèµ°åˆ°è¿™ä¸ªæ–¹æ³• Response result = getResponseWithInterceptorChain(false); if (result == null) throw new IOException(&quot;Canceled&quot;); return result; &#125; finally &#123; client.dispatcher().finished(this); &#125; &#125; è™½ç„¶dispatcherä¹Ÿæºå’Œäº†ï¼Œå…¶å®æ²¡ä»€ä¹ˆç”¨ï¼Œæ¶‰åŠåˆ° dispatcher çš„å†…å®¹åªä¸è¿‡æ˜¯åœ¨å†…éƒ¨åšäº†ä¸ªæ ‡è®°ï¼Œè¡¨æ˜æœ‰ä¸ªæœ‰ä¸ªä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼š 1234/** Used by &#123;@code Call#execute&#125; to signal it is in-flight. */ synchronized void executed(RealCall call) &#123; runningSyncCalls.add(call); &#125; 2.2 å¼‚æ­¥è¯·æ±‚2.2.1 åå‘ä»£ç†æ¨¡å‹æœåŠ¡å™¨ä¼šæ·»åŠ Headerå¹¶è‡ªåŠ¨è½¬å‘è¯·æ±‚ç»™åç«¯é›†ç¾¤ï¼Œæ¥ç€è¿”å›æ•°æ®ç»“æœç»™ç”¨æˆ·ã€‚å¯ä»¥æé«˜æœåŠ¡çš„è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œå®ç°éé˜»å¡ã€é«˜å¯ç”¨ã€é«˜å¹¶å‘è¿æ¥ï¼Œé¿å…èµ„æºå…¨éƒ¨æ”¾åˆ°ä¸€å°æœåŠ¡å™¨è€Œå¸¦æ¥çš„è´Ÿè½½ã€‚ è€Œåœ¨OkHttpä¸­ï¼Œéå¸¸ç±»ä¼¼äºä¸Šè¿°åœºæ™¯ï¼Œå®ƒä½¿ç”¨Dispatcherä½œä¸ºä»»åŠ¡çš„æ´¾å‘å™¨ï¼Œçº¿ç¨‹æ± å¯¹åº”å¤šå°åç½®æœåŠ¡å™¨ï¼Œç”¨AsyncCallå¯¹åº”Socketè¯·æ±‚ï¼Œç”¨Deque&lt;readyAsyncCalls&gt;å¯¹åº”Nginxçš„å†…éƒ¨ç¼“å­˜ã€‚ å…·ä½“æˆå‘˜å¦‚ä¸‹ maxRequests = 64: æœ€å¤§å¹¶å‘è¯·æ±‚æ•°ä¸º64 maxRequestsPerHost = 5: æ¯ä¸ªä¸»æœºæœ€å¤§è¯·æ±‚æ•°ä¸º5 Dispatcher: åˆ†å‘è€…ï¼Œä¹Ÿå°±æ˜¯ç”Ÿäº§è€…ï¼ˆé»˜è®¤åœ¨ä¸»çº¿ç¨‹ï¼‰ AsyncCall: é˜Ÿåˆ—ä¸­éœ€è¦å¤„ç†çš„Runnableï¼ˆåŒ…è£…äº†å¼‚æ­¥å›è°ƒæ¥å£ï¼‰ ExecutorServiceï¼šæ¶ˆè´¹è€…æ± ï¼ˆä¹Ÿå°±æ˜¯çº¿ç¨‹æ± ï¼‰ Deque&lt;readyAsyncCalls&gt;ï¼šç¼“å­˜ï¼ˆç”¨æ•°ç»„å®ç°ï¼Œå¯è‡ªåŠ¨æ‰©å®¹ï¼Œæ— å¤§å°é™åˆ¶ï¼‰ Deque&lt;runningAsyncCalls&gt;ï¼šæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œä»…ä»…æ˜¯ç”¨æ¥å¼•ç”¨æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ä»¥åˆ¤æ–­å¹¶å‘é‡ï¼Œæ³¨æ„å®ƒå¹¶ä¸æ˜¯æ¶ˆè´¹è€…ç¼“å­˜ é€šè¿‡å°†è¯·æ±‚ä»»åŠ¡åˆ†å‘ç»™å¤šä¸ªçº¿ç¨‹ï¼Œå¯ä»¥æ˜¾è‘—çš„å‡å°‘I/Oç­‰å¾…æ—¶é—´ã€‚ 2.2.2 å¼‚æ­¥æ‰§è¡Œè¿‡ç¨‹å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š enqueue()æ–¹æ³•è°ƒç”¨åï¼Œåˆ¤æ–­runningAsyncCallsé˜Ÿåˆ—æ˜¯å¦è¿˜æœ‰ç©ºä½å­ã€‚ è‹¥æœ‰ç©ºä½ï¼Œé‚£å°±è°ƒç”¨executorService().execute(call);äº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œè¯·æ±‚ï¼Œå¹¶ä¸”æ·»åŠ è¿›è¿è¡Œé˜Ÿåˆ— å•Šï¼Œæ²¡ç©ºä½äº†ï¼Œåªèƒ½è¿›readyAsyncCallsç­‰å¾…é˜Ÿåˆ—äº†â€¦â€¦ çœ‹ä¸€ä¸‹callä»»åŠ¡å†…éƒ¨çš„æ‰§è¡Œæ–¹æ³•ï¼š â€¦â€¦â€¦â€¦ //æœç„¶å’ŒåŒæ­¥æ–¹å¼ä¸€æ ·ï¼Œæœ€åé€šè¿‡è¿™ä¸ªæ–¹æ³•å»å‘é€ç»™ä¸‹ä¸€æ­¥ã€‚ Response response = getResponseWithInterceptorChain(forWebSocket); â€¦â€¦â€¦â€¦ finally { //æœ€å…³é”®çš„ä»£ç  client.dispatcher().finished(this); } å½“ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œæ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸ï¼Œfinallyä»£ç æ®µæ€»ä¼šè¢«æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ä¼šè°ƒç”¨Dispatcherçš„finishedå‡½æ•°ï¼Œæ‰“å¼€æºç ï¼Œå‘ç°å®ƒå°†æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡Callä»é˜Ÿåˆ—runningAsyncCallsä¸­ç§»é™¤åï¼Œæ¥ç€æ‰§è¡ŒpromoteCalls()å‡½æ•° 123456if (runningCallsForHost(call) &lt; maxRequestsPerHost) &#123; //å°†ç¼“å­˜ç­‰å¾…åŒºæœ€åä¸€ä¸ªç§»åŠ¨åˆ°è¿è¡ŒåŒºä¸­ï¼Œå¹¶æ‰§è¡Œ i.remove(); runningAsyncCalls.add(call); executorService().execute(call); &#125; å®é™…ä¸Šå°±æ˜¯ä¼šåœ¨ä»»åŠ¡æ‰§è¡Œå®Œçš„æœ€åï¼ŒæŠŠè‡ªå·±ä»è¿è¡Œé˜Ÿåˆ—ç§»é™¤ï¼Œå”¤é†’ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œè®©ä»–å»æ‰§è¡Œã€‚è¿™æ ·ï¼Œå°±ä¸»åŠ¨çš„æŠŠç¼“å­˜é˜Ÿåˆ—å‘å‰èµ°äº†ä¸€æ­¥ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨äº’æ–¥é”ç­‰å¤æ‚ç¼–ç ã€‚ 2.2.3 å¼‚æ­¥æ€»ç»“ OkHttpé‡‡ç”¨DispatcheræŠ€æœ¯ï¼Œåå‘ä»£ç†ï¼Œä¼˜åŒ–äº†å•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸çº¿ç¨‹æ± é…åˆå®ç°äº†é«˜å¹¶å‘ï¼Œä½é˜»å¡çš„è¿è¡Œ Okhttpé‡‡ç”¨Dequeä½œä¸ºç¼“å­˜ï¼ŒæŒ‰ç…§å…¥é˜Ÿçš„é¡ºåºå…ˆè¿›å…ˆå‡º OkHttpæœ€å‡ºå½©çš„åœ°æ–¹å°±æ˜¯åœ¨try/finallyä¸­è°ƒç”¨äº†finishedå‡½æ•°ï¼Œå¯ä»¥åœ¨ä»»åŠ¡ç»“æŸæ—¶å€™å”¤é†’ç­‰å¾…çš„ä»»åŠ¡ï¼Œä¸»åŠ¨æ§åˆ¶ç­‰å¾…é˜Ÿåˆ—çš„ç§»åŠ¨ï¼Œè€Œä¸æ˜¯é‡‡ç”¨é”æˆ–è€…wait/notifyï¼Œæå¤§å‡å°‘äº†ç¼–ç å¤æ‚æ€§ 3. å·¥ä½œçš„æ ¸å¿ƒâ€”-æ‹¦æˆªå™¨3.1 æ‹¦æˆªå™¨çš„ä»‹ç»ä¸ç§ç±»ä¸ç®¡åŒæ­¥å¼‚æ­¥å‘é€ä»»åŠ¡è¯·æ±‚ï¼Œæœ€åéƒ½ä¼šæ‰§è¡ŒgetResponseWithInterceptorChain: 123456789101112131415161718private Response getResponseWithInterceptorChain() throws IOException &#123; // Build a full stack of interceptors. List&lt;Interceptor&gt; interceptors = new ArrayList&lt;&gt;(); interceptors.addAll(client.interceptors()); interceptors.add(retryAndFollowUpInterceptor); interceptors.add(new BridgeInterceptor(client.cookieJar())); interceptors.add(new CacheInterceptor(client.internalCache())); interceptors.add(new ConnectInterceptor(client)); if (!retryAndFollowUpInterceptor.isForWebSocket()) &#123; interceptors.addAll(client.networkInterceptors()); &#125; interceptors.add(new CallServerInterceptor( retryAndFollowUpInterceptor.isForWebSocket())); Interceptor.Chain chain = new RealInterceptorChain( interceptors, null, null, null, 0, originalRequest); return chain.proceed(originalRequest);&#125; æ‹¦æˆªå™¨æ˜¯ä¸ªå•¥ï¼Ÿå®˜æ–¹ä»‹ç»å’Œå›¾ç‰‡ï¼š the whole thing is just a stack of built-in interceptors. å¯è§ Interceptor æ˜¯ OkHttp æœ€æ ¸å¿ƒçš„ä¸€ä¸ªä¸œè¥¿ï¼Œä¸è¦è¯¯ä»¥ä¸ºå®ƒåªè´Ÿè´£æ‹¦æˆªè¯·æ±‚è¿›è¡Œä¸€äº›é¢å¤–çš„å¤„ç†ï¼ˆä¾‹å¦‚ cookieï¼‰ï¼Œå®é™…ä¸Šå®ƒæŠŠå®é™…çš„ç½‘ç»œè¯·æ±‚ã€ç¼“å­˜ã€é€æ˜å‹ç¼©ç­‰åŠŸèƒ½éƒ½ç»Ÿä¸€äº†èµ·æ¥ï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½éƒ½åªæ˜¯ä¸€ä¸ª Interceptorï¼Œå®ƒä»¬å†è¿æ¥æˆä¸€ä¸ª Interceptor.Chainï¼Œç¯ç¯ç›¸æ‰£ï¼Œæœ€ç»ˆåœ†æ»¡å®Œæˆä¸€æ¬¡ç½‘ç»œè¯·æ±‚ã€‚ ä» getResponseWithInterceptorChain å‡½æ•°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒInterceptor.Chain çš„åˆ†å¸ƒä¾æ¬¡æ˜¯ï¼š åœ¨é…ç½® OkHttpClient æ—¶è®¾ç½®çš„ interceptorsï¼› è´Ÿè´£å¤±è´¥é‡è¯•ä»¥åŠé‡å®šå‘çš„ RetryAndFollowUpInterceptorï¼› è´Ÿè´£æŠŠç”¨æˆ·æ„é€ çš„è¯·æ±‚è½¬æ¢ä¸ºå‘é€åˆ°æœåŠ¡å™¨çš„è¯·æ±‚ã€æŠŠæœåŠ¡å™¨è¿”å›çš„å“åº”è½¬æ¢ä¸ºç”¨æˆ·å‹å¥½çš„å“åº”çš„ BridgeInterceptorï¼› è´Ÿè´£è¯»å–ç¼“å­˜ç›´æ¥è¿”å›ã€æ›´æ–°ç¼“å­˜çš„ CacheInterceptorï¼› è´Ÿè´£å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥çš„ ConnectInterceptorï¼› é…ç½® OkHttpClient æ—¶è®¾ç½®çš„ networkInterceptorsï¼› è´Ÿè´£å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ•°æ®ã€ä»æœåŠ¡å™¨è¯»å–å“åº”æ•°æ®çš„CallServerInterceptorã€‚ 3.2 æ‹¦æˆªå™¨çš„è´£ä»»é“¾æ¨¡å¼å®é™…ä¸Šï¼Œæ˜¯è´£ä»»é“¾æ¨¡å¼çš„æœ€ä½³åº”ç”¨ï¼ˆå¦‚åŒäº‹ä»¶åˆ†å‘æœºåˆ¶ï¼‰ï¼Œæ¯ä¸ªæ‹¦æˆªå™¨å¯ä»¥è‡ªå·±æ‹¦æˆªå¤„ç†ï¼Œæˆ–è€…äº¤ç»™ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œè®©æ¯ä¸ª Interceptor è‡ªè¡Œå†³å®šèƒ½å¦å®Œæˆä»»åŠ¡ä»¥åŠæ€ä¹ˆå®Œæˆä»»åŠ¡ã€‚ å…¶å® Interceptor çš„è®¾è®¡ä¹Ÿæ˜¯ä¸€ç§åˆ†å±‚çš„æ€æƒ³ï¼Œæ¯ä¸ª Interceptor å°±æ˜¯ä¸€å±‚ã€‚ä¸ºä»€ä¹ˆè¦å¥—è¿™ä¹ˆå¤šå±‚å‘¢ï¼Ÿåˆ†å±‚çš„æ€æƒ³åœ¨ TCP/IP åè®®ä¸­å°±ä½“ç°å¾—æ·‹æ¼“å°½è‡´ï¼Œåˆ†å±‚ç®€åŒ–äº†æ¯ä¸€å±‚çš„é€»è¾‘ï¼Œæ¯å±‚åªéœ€è¦å…³æ³¨è‡ªå·±çš„è´£ä»»ï¼ˆå•ä¸€åŸåˆ™æ€æƒ³ä¹Ÿåœ¨æ­¤ä½“ç°ï¼‰ï¼Œè€Œå„å±‚ä¹‹é—´é€šè¿‡çº¦å®šçš„æ¥å£/åè®®è¿›è¡Œåˆä½œï¼ˆé¢å‘æ¥å£ç¼–ç¨‹æ€æƒ³ï¼‰ï¼Œå…±åŒå®Œæˆå¤æ‚çš„ä»»åŠ¡ã€‚ 4 æ€»ç»“ OkHttpClient å®ç° Call.Factoryï¼Œè´Ÿè´£ä¸º Request åˆ›å»º Callï¼› RealCall ä¸ºå…·ä½“çš„ Call å®ç°ï¼Œå…¶ enqueue() å¼‚æ­¥æ¥å£é€šè¿‡ Dispatcher åˆ©ç”¨ ExecutorService å®ç°ï¼Œè€Œæœ€ç»ˆè¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶å’ŒåŒæ­¥ execute() æ¥å£ä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡ getResponseWithInterceptorChain() å‡½æ•°å®ç°ï¼› getResponseWithInterceptorChain() ä¸­åˆ©ç”¨ Interceptor é“¾æ¡ï¼Œåˆ†å±‚å®ç°ç¼“å­˜ã€é€æ˜å‹ç¼©ã€ç½‘ç»œ IO ç­‰åŠŸèƒ½ï¼› å¼•ç”¨ OkHttp3æºç åˆ†ææ‹†è½®å­ç³»åˆ—ï¼šæ‹† OkHttp"},{"title":"hexoå¿«é€Ÿå…¥é—¨æŒ‡å—","permalink":"http://www.youyuge.cn/2017/05/21/hello-world/","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post 1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment"},{"title":"ç¬¬ä¸€ç¯‡åšå®¢ï¼Œæ–°çš„å¼€å§‹","permalink":"http://www.youyuge.cn/2017/05/10/my_first_post_test/","text":"æ¬¢è¿æ¥åˆ°å°¤æ™Ÿçš„åšå®¢~ 1. ä»£ç æ ¼å¼å±•ç¤º1.1 ä»£ç å±•ç¤ºåŒº123public void show()&#123;&#125;"}]}